@theme {
  --color-code-block-background: #eff1f5;
}

@layer theme {
  :root.dark {
    --color-code-block-background: rgb(30, 30, 46);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-block-background: rgb(30, 30, 46);
    }
  }
}

html.dark .shiki,
html.dark .shiki span {
  color: var(--shiki-dark) !important;
}

html.dark .shiki {
  background-color: var(--shiki-dark-bg) !important;
}

@utility ark-code-block {
  @apply bg-code-block-background;
  max-height: var(--code-max-height);
  min-height: var(--code-min-height);

  & > .shiki {
    @apply p-4 outline-none;
    counter-reset: step;
    counter-increment: step 0;
  }

  & > .shiki .line::before {
    content: counter(step);
    counter-increment: step;
    width: 1rem;
    margin-right: 1.5rem;
    display: inline-block;
    text-align: right;
    color: rgba(115, 138, 148, 0.4);
  }

  &.flex-1 {
    @apply flex flex-col;
  }

  &.flex-1 > .shiki {
    flex: 1;
  }

  &.code-block-fit {
    @apply flex flex-col flex-1;
    overflow: auto;
  }

  &.code-block-fit > .shiki {
    background-color: transparent !important;
  }

  .line.diff.add {
    background-color: rgba(0, 255, 0, 0.1);
    border-radius: 3px;
    padding-right: 6px;
  }

  .line.diff.remove {
    background-color: rgba(255, 0, 0, 0.1);
    border-radius: 3px;
    padding-right: 6px;
  }
}

@utility ark-code-block-loading {
  @apply flex flex-col items-center justify-center p-6;
}

@utility ark-code-viewer {
  @apply flex flex-col w-full;
}

@utility ark-code-viewer-body {
  @apply flex flex-col w-full bg-code-block-background overflow-auto;
}

@utility ark-code-viewer-buttons {
  @apply flex items-center bg-foreground/10 w-full overflow-x-auto flex-nowrap;
}

@utility ark-code-viewer-button {
  @apply flex items-center gap-1 flex-none;
  @apply px-4 py-2.5 text-sm font-medium;
  @apply transition-all relative rounded-t-lg;

  & > * {
    @apply z-10;
  }

  &:not(.active):hover:before {
    @apply bg-code-block-background/75 rounded-lg;
    width: calc(100% - 8px);
    height: calc(100% - 8px);
    content: '';
    display: block;
    position: absolute;
    left: 4px;
    top: 4px;
    z-index: 0;
  }

  &.active {
    @apply text-foreground bg-code-block-background;

    &:before,
    &:after {
      content: '';
      display: block;
      width: 10px;
      height: 10px;
      position: absolute;
      bottom: 0;
      background-color: blue;
    }

    &:before {
      right: -10px;
      background: radial-gradient(circle at 100% 0, transparent 70%, var(--color-code-block-background) 75%);
    }

    &:after {
      left: -10px;
      background: radial-gradient(circle at 0 0, transparent 70%, var(--color-code-block-background) 75%);
    }
  }

  & > img {
    @apply w-4 h-4;
  }
}
